

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Optimized components &mdash; LinguiJS  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Pluralization" href="plurals.html" />
    <link rel="prev" title="Dynamic loading of message catalogs" href="dynamic-loading-catalogs.html" />
 
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-52365043-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-52365043-2');
</script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> LinguiJS
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Installation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/setup-cra.html">Create React App</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/setup-react.html">React project</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/react.html">React</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/react-patterns.html">React - common patterns</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/react-native.html">React Native</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/javascript.html">JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/cli.html">CLI</a></li>
</ul>
<p class="caption"><span class="caption-text">Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="testing.html">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="typescript.html">Typescript</a></li>
<li class="toctree-l1"><a class="reference internal" href="excluding-build-files.html">Excluding build files</a></li>
<li class="toctree-l1"><a class="reference internal" href="dynamic-loading-catalogs.html">Dynamic loading of translations</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Optimized components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#translations-inside-optimized-component">Translations inside optimized component</a></li>
<li class="toctree-l2"><a class="reference internal" href="#optimized-component-wrapped-in-withi18n">Optimized component wrapped in <code class="xref js js-func docutils literal notranslate"><span class="pre">withI18n()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#summary">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plurals.html">How plurals work</a></li>
</ul>
<p class="caption"><span class="caption-text">API References</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../ref/core.html">Core (JavaScript)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/react.html">React</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/macro.html">Macros</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/cli.html">CLI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/conf.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/loader.html">Webpack Loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/catalog-formats.html">Catalog Formats</a></li>
<li class="toctree-l1"><a class="reference internal" href="../ref/message-format.html">ICU MessageFormat</a></li>
</ul>
<p class="caption"><span class="caption-text">Releases</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../releases/migration-2.html">Migration from 1.x to 2.x</a></li>
<li class="toctree-l1"><a class="reference internal" href="../releases/migration-1.html">Migration from 0.x to 1.x</a></li>
</ul>
<p class="caption"><span class="caption-text">Discussion</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../misc/showroom.html">Projects using LinguiJS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/react-intl.html">Comparison with react-intl</a></li>
<li class="toctree-l1"><a class="reference internal" href="../misc/talks-about-i18n.html">Talks and articles about i18n in JavaScript</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rfc/toc.html">RFCs and design decisions</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">LinguiJS</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Optimized components</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/lingui/js-lingui/blob/master/docs/guides/optimized-components.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="optimized-components">
<span id="guide-optimized-components"></span><h1>Optimized components<a class="headerlink" href="#optimized-components" title="Permalink to this headline">¶</a></h1>
<p>Let’s call any component implementing <code class="docutils literal notranslate"><span class="pre">shouldComponentUpdate</span></code> an <em>Optimized
component</em>.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p><strong>TL;DR:</strong> Optimized components are handled correctly in LinguiJS by default.
Read this document if you want to understand how things work under the hood.</p>
</div>
<p>React components can be optimized to skip updates implementing
<code class="docutils literal notranslate"><span class="pre">shouldComponentUpdate</span></code>. Based on change of props and state, component
can decide to continue re-rendering or skip the update completely.
However, LinguiJS reads translations from context and there’re two cases
which must be handled to make i18n related updates reliable.</p>
<p>The two cases to handle are:</p>
<ol class="arabic simple">
<li><p>Translations inside optimized component.</p></li>
<li><p>Optimized component is wrapped in <a class="reference internal" href="../ref/react.html#withI18n" title="withI18n"><code class="xref js js-func docutils literal notranslate"><span class="pre">withI18n()</span></code></a> to translate text attributes.</p></li>
</ol>
<p>Let’s take a look at both scenarios.</p>
<div class="section" id="translations-inside-optimized-component">
<h2>Translations inside optimized component<a class="headerlink" href="#translations-inside-optimized-component" title="Permalink to this headline">¶</a></h2>
<p>Imagine following React tree:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;OptimizedComponent&gt;
   &lt;AnotherComponent&gt;
       &lt;Trans&gt;I am not alone!&lt;/Trans&gt;
   &lt;/AnotherComponent&gt;
&lt;/OptimizedComponent&gt;
</pre></div>
</div>
<p>When active language is changed or message catalog is updated,
<code class="docutils literal notranslate"><span class="pre">OptimizedComponent</span></code> will probably skip the update, because it’s props
don’t change. It means that all children of <code class="docutils literal notranslate"><span class="pre">OptimizedComponent</span></code> won’t be
updated, including <a class="reference internal" href="../ref/react.html#component-Trans">&lt;Trans&gt;</a> component.</p>
<p>By default, all <a class="reference internal" href="../ref/react.html#component-Trans">&lt;Trans&gt;</a> components listen for language and catalog changes
and update themselves when it happens. Even if <code class="docutils literal notranslate"><span class="pre">OptimizedComponent</span></code>
skips update, <a class="reference internal" href="../ref/react.html#component-Trans">&lt;Trans&gt;</a> component is updated correctly.</p>
<p>Also, <a class="reference internal" href="../ref/react.html#withI18n" title="withI18n"><code class="xref js js-func docutils literal notranslate"><span class="pre">withI18n()</span></code></a> HOC listens for language and catalog changes, but this
behavior can be disabled by passing <code class="docutils literal notranslate"><span class="pre">update</span> <span class="pre">=</span> <span class="pre">false</span></code> option:</p>
<div class="highlight-jsx notranslate"><div class="highlight"><pre><span></span><span class="c1">// Component won&#39;t listen for language/catalog changes</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">withI18n</span><span class="p">({</span> <span class="nx">update</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">})(</span><span class="nx">Component</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="optimized-component-wrapped-in-withi18n">
<h2>Optimized component wrapped in <a class="reference internal" href="../ref/react.html#withI18n" title="withI18n"><code class="xref js js-func docutils literal notranslate"><span class="pre">withI18n()</span></code></a><a class="headerlink" href="#optimized-component-wrapped-in-withi18n" title="Permalink to this headline">¶</a></h2>
<p>Component should be wrapped in <a class="reference internal" href="../ref/react.html#withI18n" title="withI18n"><code class="xref js js-func docutils literal notranslate"><span class="pre">withI18n()</span></code></a> HOC when it’s required to access
low-level i18n API. Common usecase is translation of attributes:</p>
<div class="highlight-jsx notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>
<span class="kr">import</span> <span class="p">{</span> <span class="nx">t</span><span class="p">,</span> <span class="nx">Trans</span> <span class="p">}</span> <span class="nx">from</span> <span class="s1">&#39;@lingui/macro&#39;</span>

<span class="kr">class</span> <span class="nx">HeaderLink</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">PureComponent</span> <span class="p">{</span>
   <span class="nx">render</span> <span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="p">&lt;</span><span class="nt">a</span> <span class="na">title</span><span class="o">=</span><span class="p">{</span><span class="nx">i18n</span><span class="p">.</span><span class="nx">_</span><span class="p">(</span><span class="nx">t</span><span class="sb">`Title`</span><span class="p">)}&gt;&lt;</span><span class="nt">Trans</span><span class="p">&gt;</span><span class="nx">Header</span><span class="p">&lt;/</span><span class="nt">Trans</span><span class="p">&gt;&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
   <span class="p">}</span>
<span class="p">}</span>

<span class="kr">export</span> <span class="k">default</span> <span class="nx">withI18n</span><span class="p">()(</span><span class="nx">HeaderLink</span><span class="p">)</span>
</pre></div>
</div>
<p>Content of link will be updated correctly as discussed in previous section.
However, text attributes aren’t components but only function calls so they can’t
listen to changes of active language and catalog.</p>
<p>The trick here is to update whole component, but since it’s a PureComponent,
it does shallow comparison of props. <a class="reference internal" href="../ref/react.html#withI18n" title="withI18n"><code class="xref js js-func docutils literal notranslate"><span class="pre">withI18n()</span></code></a> HOC makes things easier by
passing <code class="docutils literal notranslate"><span class="pre">i18nHash</span></code> to wrapped component. This hash is changed after every
change of active language or catalog.</p>
<p>If you have your own implementation of <code class="docutils literal notranslate"><span class="pre">shouldComponentUpdate</span></code>, simply compare
also <code class="docutils literal notranslate"><span class="pre">i18nHash</span></code>:</p>
<div class="highlight-jsx notranslate"><div class="highlight"><pre><span></span><span class="kr">import</span> <span class="o">*</span> <span class="nx">as</span> <span class="nx">React</span> <span class="nx">from</span> <span class="s1">&#39;react&#39;</span>

<span class="kr">class</span> <span class="nx">HeaderLink</span> <span class="kr">extends</span> <span class="nx">React</span><span class="p">.</span><span class="nx">Component</span> <span class="p">{</span>
   <span class="nx">shouldComponentUpdate</span><span class="p">(</span><span class="nx">nextProps</span><span class="p">,</span> <span class="nx">nextState</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">nextProps</span><span class="p">.</span><span class="nx">i18nHash</span> <span class="o">!==</span> <span class="k">this</span><span class="p">.</span><span class="nx">props</span><span class="p">.</span><span class="nx">i18nHash</span> <span class="cm">/* &amp;&amp; your condition */</span>
   <span class="p">}</span>

   <span class="nx">render</span> <span class="p">()</span> <span class="p">{</span>
      <span class="c1">// render component as usual</span>
   <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If you don’t want your component to receive this hash for whatever reason,
you can disable it by passing <code class="docutils literal notranslate"><span class="pre">withHash</span> <span class="pre">=</span> <span class="pre">false</span></code> option to HOC:</p>
<div class="highlight-jsx notranslate"><div class="highlight"><pre><span></span><span class="c1">// Component won&#39;t pass i18nHash prop</span>
<span class="kr">export</span> <span class="k">default</span> <span class="nx">withI18n</span><span class="p">({</span> <span class="nx">withHash</span> <span class="o">=</span> <span class="kc">false</span> <span class="p">})(</span><span class="nx">Component</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="summary">
<h2>Summary<a class="headerlink" href="#summary" title="Permalink to this headline">¶</a></h2>
<p>LinguiJS handles updates in and for Optimized components in most cases. If you
want to disable this behavior, you can pass either <code class="docutils literal notranslate"><span class="pre">update</span> <span class="pre">=</span> <span class="pre">false</span></code>
or <code class="docutils literal notranslate"><span class="pre">withHash</span> <span class="pre">=</span> <span class="pre">false</span></code> to <a class="reference internal" href="../ref/react.html#withI18n" title="withI18n"><code class="xref js js-func docutils literal notranslate"><span class="pre">withI18n()</span></code></a> HOC.</p>
<p><code class="docutils literal notranslate"><span class="pre">update</span></code> fixes updates if component has optimized parents while <code class="docutils literal notranslate"><span class="pre">withHash</span></code>
fixes updates for intermediate optimized children.</p>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://reactjs.org/docs/optimizing-performance.html#avoid-reconciliation">React docs: Optimizing Performance</a></p></li>
<li><p><a class="reference external" href="https://medium.com/react-ecosystem/how-to-handle-react-context-a7592dfdcbc">How to handle React context in a reliable way</a></p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="plurals.html" class="btn btn-neutral float-right" title="Pluralization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="dynamic-loading-catalogs.html" class="btn btn-neutral float-left" title="Dynamic loading of message catalogs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Tomáš Ehrlich

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>